function [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 10-Aug-2017 19:16:36.
%
% [y1,xf1,xf2] = myNeuralNetworkFunction(x1,x2,xi1,xi2) takes these arguments:
%   x1 = 2xTS matrix, input #1
%   x2 = 1xTS matrix, input #2
%   xi1 = 2x8 matrix, initial 8 delay states for input #1.
%   xi2 = 1x8 matrix, initial 8 delay states for input #2.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 2x8 matrix, final 8 delay states for input #1.
%   xf2 = 1x8 matrix, final 8 delay states for input #2.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1.3709883398;-0.9821721285];
x1_step1.gain = [0.593614558819044;0.556508725892986];
x1_step1.ymin = -1;

% Input 2
x2_step1.xoffset = -0.7494690941;
x2_step1.gain = 0.329463977892752;
x2_step1.ymin = -1;

% Layer 1
b1 = [1.558585236989313616;1.3478292732341259352;1.2693074310894025825;1.1681440698382925536;-0.94746789286318966461;0.66857332889143517018;-0.60735728505597608162;0.45841157755811484664;-0.24347334495603681348;0.0074374415164072844864;0.052175701243969765941;0.24098197931607681643;0.49080761885053425519;-0.67361187716464754338;-0.58908746415456103573;-0.90900906757451327422;1.1418283001740663352;-1.3235001812204214566;-1.4127186837345431236;1.6205195819378734878];
IW1_1 = [-0.34884012685013765509 0.22060906482459605171 -0.4412425587986673059 -0.19055511611944792039 -0.35088918931857976391 0.040270186522465389878 0.11817611380957304679 0.54448337635155519276 -0.59231717340276213157 -0.093596869909538332744 -0.27091668947347269381 -0.48946716720861699335 0.10345127069570270173 -0.26747914062278876912 -0.32777522808139392119 -0.28633945241657676739;-0.03998773929311130737 -0.3669593934559028936 0.47566283459105779263 0.097471025948551850981 -0.17875586754335753836 -0.11160336230590164885 0.17370845795670369904 0.5511463908840011916 -0.1778952878545085603 0.1236951837685725808 -0.095265679433763988948 -0.5172951128048961511 0.44611331683005528426 0.59425286519957254416 0.27379101074331563259 -0.22120551185940848238;-0.34154300321119313022 -0.016814718543129800882 -0.4199647300368891667 0.1523964652056248037 0.098989660349822025665 0.17172673535042590198 -0.40352872472190043363 -0.21915269094259864913 -0.30580928563983256208 -0.18422751077739313308 -0.58237935491756320783 0.11399896987994574682 -0.21435123437394501544 -0.045510998040407070475 -0.20279568298638384061 -0.43998821347178446173;-0.38225077399550988488 0.16430984963039829694 0.36774214155394857606 -0.17271003992553318751 -0.077475668449087736755 -0.19529870627824577611 -0.22909940501294417947 -0.51394665415990270496 -0.14110881008688416771 0.39844015928248582847 0.37028001310109737165 0.14229400833752137157 -0.53669881802312979779 -0.013390430718780909833 0.31524026482495387524 0.093126208253467387954;0.12464279454662761937 0.065212805253988578857 0.20205432810283560641 0.45686378453004072853 0.23059522531472315121 -0.17621207659697021852 0.051734314757781146854 -0.40392797963939441885 -0.55437438779682479684 0.063408326998326033919 -0.40200113745099069762 -0.41845708867002873177 -0.27790299055715123044 -0.33260666988739195915 0.48650110791124673293 -0.18664383629607619874;-0.22934045875112443746 0.60652932014194482768 -0.54165253552798231507 0.28982634976766696866 0.35278990104541280148 0.30235019563946696763 0.001325535126279756698 0.04549134777822483322 0.21864066874256823936 -0.44650183628151679516 0.19985562871639858673 0.50287839220930852235 0.54393456042350174506 0.41238716345998349677 0.39168229020425870957 -0.46555333504565893366;0.072784545265265024327 -0.14239759773358465211 0.57239177482032999045 0.0554491096635775782 0.17477044159382607025 -0.3493574085714363231 0.23233666137001010576 -0.053207838030238423233 -0.1513612842473087694 0.24168327500893352355 0.33220795358044630241 -0.37585949451291406076 -0.58450730100711800752 -0.35274046085804022788 -0.37211540573753382199 -0.10973994787598534417;-0.51714339851008039872 0.2197640674915789516 0.22752567609235535562 -0.19009840801381039377 -0.30340886387589871553 -0.47003752320432884426 -0.42903948067012154244 -0.26464989509773167997 0.28998304059641044628 -0.3553777660180740261 -0.23261783162701346606 -0.50690528006189272681 -0.046018503408178465519 -0.21109766906110996598 -0.31095978670135915323 -0.32785804274057944729;0.5667639997661509943 -0.42827266506705535809 -0.12290097240414134261 -0.15985306009660674165 -0.12729441112485498366 0.523040813564837892 0.085083190122240318076 -0.038142918905651967965 0.40452066149201143519 -0.15475642274712844704 0.12635505156858203857 0.22870333622160912701 -0.56874184572482022748 -0.50766996926025576009 0.28797485649543719255 0.14310460961391410772;-0.24655892851152977352 -0.47998499282085499429 -0.31403637830493513761 -0.3996251914800739713 -0.4948558076530572003 -0.44959691655872247029 0.032340439971313694745 0.030122787462928270197 -0.16970921132442007284 -0.36172162766882171026 -0.64688680343552773522 0.49037199725796665195 -0.52919040643765069554 -0.00056900208348170666639 -0.40652211287524664396 -0.056394360694843645443;0.037027681604692587458 0.12010434136413834783 -0.13038240956440183549 -0.38005777963149034449 -0.43145333715384398543 0.33679750855727785819 0.48759882730050008171 0.41492467647032466038 0.13078727505550957755 -0.043672525481953897164 -0.57529554411051830876 -0.03217510513618167256 -0.58893639118162099955 -0.10605266083885850348 -0.59720904181216627471 0.57051858474341077265;0.79947077831816648619 0.36059732290756024709 0.24037909744279398194 0.30870323672439209384 -0.18813370087435740685 -0.014191589414112880385 0.54816901327254063947 0.2590840391750443561 0.24679668445602953586 0.17850182762655392166 -0.47147028314227434898 0.50374146273682451902 -0.3617734763059519687 0.7173886234449449173 -0.54984661061485329281 0.054662784069495304329;-0.070696769128933689696 0.089925652331088040681 -0.40722078316566684419 -0.40374208740768446901 0.62750918369654551388 -0.1779642923459906767 -0.20491975934264913817 -0.2949380453798677304 0.5609313852976987036 0.48101192495666805771 0.51678439336607395749 0.25193548235280738279 0.30919960842649907296 -0.2421820423147023893 0.29548032685662956043 0.048427838963554376006;-0.57326339176546159404 0.63853971126831177152 0.0111778866755097607 -0.41399283497866740111 -0.17769021968894588293 -0.16212480988880109689 -0.19436524560141987816 -0.37755474481350176363 0.389981372913648483 -0.4016390244449091762 0.29543456121610933707 -0.37813444500866705278 -0.18028734607646978994 -0.26221960814865813427 -0.30473607947883868396 -0.33995098516642441311;-0.21234890184665017321 -0.23556610728110577435 -0.060332817792328997941 -0.5689632354203740805 -0.29624596175546735743 -0.35857834879791417038 -0.45635646729213663608 -0.45933967058318170285 -0.38751369031637400431 -0.33667129130212292143 -0.10646074053648771351 -0.45808317013525956529 -0.23418108726073308401 -0.46696563811437918901 -0.28161362518365029572 -0.58523289794271404762;-0.27047510034798649681 -0.20932348452888313584 -0.27568836182483197339 0.5321709779250491934 0.43247103868361941315 0.044865728725076235717 -0.17971912090814298746 -0.10554513257540210081 -0.2522192362374514607 0.15984068948288604473 0.33353333692206360572 -0.063686075420029603089 -0.51026408047066607043 -0.39809017423255022017 -0.2103534965360362996 -0.41183919203535984677;0.27409168145253148818 0.18130716910214708659 -0.32776685728239973727 -0.34365604847950620426 0.41729268685913550874 -0.22656784531619830747 0.015353612321147432421 0.29935317064293770484 0.39080361056182416624 0.12849936222433208655 0.32708073679828963964 0.38360580331914689856 -0.1328991676985228354 0.39946735764869983898 0.57036957328539905632 -0.3771346871264574796;-0.10625971010823991036 -0.31562122136049075571 -0.31595308689236700772 -0.25428137731122529841 0.10173483558712542729 -0.2466896398882100494 -0.43122600832152124806 0.30057729783013553693 -0.094993994835421480261 -0.24869983409857815415 -0.44280459915737990784 0.21785094133574736674 0.57725295224757011692 0.43433358300486113457 0.16321205610318761936 -0.031818030945399616849;-0.45915876477998268657 0.51641338849990037208 -0.25070476067116859165 0.18604663675820914959 0.49292769137591668782 0.34946158536977911524 -0.40013812972532919465 -0.017884732508682572166 0.028577553967414959235 -0.37527612464424731087 0.12816066832518430152 -0.53286198098417192348 -0.12221051914340759492 0.43754857169630329006 0.50418254314506971703 -0.078666923163317734047;0.23522678482982134485 -0.45126414762538874514 0.2351769638423781561 -0.017151452064238990186 0.3808483531732163585 -0.082894566169149030976 0.27278431660660057423 -0.18833919368780349668 -0.080182988756237680295 -0.10402534643222219324 0.273750047481995884 0.55539058364293703018 -0.46806944836762615081 0.50486488266871398789 0.18015959197793440794 0.17159146242509093483];
IW1_2 = [0.12930192468104509396 -0.16285199607182979098 0.25464872272254640562 -0.31644198093640391045 -0.16381245584798348469 -0.19718942827285612651 -0.50518539235602222259 -0.46089887531930351372;-0.37828626079595606413 -0.14048805090938451534 0.20397808726479299546 -0.26951516201208092216 -0.4142160662188945075 0.51655423980902326342 -0.14001077631283426195 0.35669571088996515629;0.48877089008266244585 -0.45407961931308238324 -0.39684168108821893384 -0.18570043881191980462 -0.02367963512054779493 -0.54939911442870648095 0.067880991238778234931 -0.49263161424931517507;0.27528819939295173791 0.23339490601718940188 -0.27375723593347456308 0.54370400431076748582 -0.097328847489699069073 -0.26404670076519759503 0.331480898162272275 -0.23362284481924591728;0.14955839741809220933 -0.22272919027671278513 0.21236056076190640285 -0.39863389027095552652 0.24491005482302538598 -0.066130037845076511394 0.27356808950363953326 -0.050486005419167506725;0.12155059520017075236 -0.32698514051539445679 0.33709351606754939246 0.39589934870796711364 -0.0049038596119748145696 -0.3368444282759558428 -0.15285357109138322795 -0.52987411108349724564;0.56028422370175556821 0.57133859653226670705 0.26479724070637078448 -0.25419763919290311316 0.30387253106459943819 0.58242437676318437045 -0.16706821312499278709 0.07541565834383623379;0.085846544870339755451 0.5213456702380370178 0.019301438710455292441 0.49432796408248630415 0.26387671948246260722 -0.048114583513167906437 -0.19794752718890640253 -0.030050866955980904544;0.35007812720014136465 0.21893886146982782792 -0.26915668205878701125 0.13619065796970497573 -0.44162427515632052266 0.48224745768451815486 -0.33411708142512891451 -0.32252652541447651702;-0.3068319497822408759 -0.25708180386778473059 0.098052620167666082462 0.35788799759961953395 -0.48080801485735291667 0.088226008112662568372 0.60938273417624733153 -0.35454272726216140565;0.38201380284025920897 -0.51010664915969616828 0.030601708759953695493 -0.40906076858902223892 -0.19347971182629397635 -0.016589361621567495775 0.19505702705219069015 0.3055753088645943305;-0.28342862409442309835 -0.2815356091303542474 -0.12151522898674296802 0.2338008533554007673 0.095876270761465681725 -0.25570094123635533911 -0.10057526587473453183 -0.20605519707523503592;-0.48317292530728755962 0.03659376987781617907 -0.28144844411794600614 -0.53659577105413136522 -0.35613289279459114933 -0.2463879912168429609 0.28501511682455166197 0.51982065543344602165;-0.098771929157315183079 0.45754483407429485942 -0.077331398291551348145 -0.31379561348545642607 -0.0026730964301787301166 -0.1755906709936252974 -0.28428141774559340105 0.39632842460655787198;-0.25058051855623597604 -0.14477760077212747936 -0.42959583958846531138 -0.043642874927395325368 0.060102700195365635349 -0.4890975973518961184 -0.32720914172001569487 -0.26725029651665310748;-0.45596183768571341144 -0.46733268638816971574 0.55449674136231108523 -0.094354785898183413106 0.035592344033945080839 -0.10595589893286533334 -0.12205023293889703806 -0.080629097532003923821;-0.28355480661909487905 -0.46683578489960636526 0.15508278281707565949 0.016547405436503237475 -0.3093694271526176709 0.063469919476463007579 -0.49327439378665299818 0.42814917034062810464;-0.14947539175727128646 -0.29897398014872961225 0.5632396494582918578 -0.023682654031131199213 0.43289130444348178361 0.17726363626989358191 0.13931108413575565841 0.51436352341656577103;0.26201865923631967314 0.413938566443033229 -0.010367908985751234444 0.21504912394381273111 -0.19203079576684270457 -0.094111462589215016949 0.37064215173154824168 0.10775579534257170855;0.57458637546736168744 -0.19789621981827182351 -0.21473911439239967702 -0.65105311110125696494 -0.032074364810868123687 -0.33542248085944775804 0.36746186807851027867 0.69927060985765587819];

% Layer 2
b2 = -0.15747362574616924347;
LW2_1 = [0.5700684984673051181 1.0117059143546296429 -0.066452028058861772886 -0.44693330647040790948 0.5383127981776859583 0.88686707130362008034 0.64229119444077187318 -0.64727866389276256243 -0.4700522202444292752 0.88631795809557833987 -0.6525317621926175482 0.66236939483115331306 -0.85971175663302534797 0.98991293184333351007 -0.20631962454184590849 -0.67420753771878549898 0.27107764748883256267 0.71572026003240030168 0.6388376122586189032 0.86137905758626298613];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.329463977892752;
y1_step1.xoffset = -0.7494690941;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(2,1)];

% Input 2 Delay States
xd2 = mapminmax_apply(xi2,x2_step1);
xd2 = [xd2 zeros(1,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+7,9)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Input 2
    xd2(:,xdts) = mapminmax_apply(x2(:,ts),x2_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8]-1,9)+1),16,1);
    tapdelay2 = reshape(xd2(:,mod(xdts-[1 2 3 4 5 6 7 8]-1,9)+1),8,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 8);
xits = finalxts(finalxts<=8);
xts = finalxts(finalxts>8)-8;
xf1 = [xi1(:,xits) x1(:,xts)];
xf2 = [xi2(:,xits) x2(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
